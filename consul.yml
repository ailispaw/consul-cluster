consul: &consul
  image: progrium/consul
  ports:
    - 8300:8300
    - 8301:8301/tcp
    - 8301:8301/udp
    - 8302:8302/tcp
    - 8302:8302/udp
    - 8400:8400
    - 8500:8500
    - 53:53/tcp
    - 53:53/udp
  entrypoint: /bin/sh

master: &master
  <<: *consul
  command:
    - -c
    - /bin/start -server -bootstrap -advertise=${NODE_IP} -join=${JOIN_IP}

slave: &slave
  <<: *consul
  command:
    - -c
    - /bin/start -server -advertise=${NODE_IP} -join=${JOIN_IP}

client: &client
  <<: *consul
  command:
    - -c
    - /bin/start -advertise=${NODE_IP} -join=${JOIN_IP}

node-01:
  <<: *master

node-02:
  <<: *slave

node-03:
  <<: *client

registrator:
  image: gliderlabs/registrator
  volumes:
    - /var/run/docker.sock:/tmp/docker.sock
  links:
    - consul
  command:
    - consul://consul:8500
